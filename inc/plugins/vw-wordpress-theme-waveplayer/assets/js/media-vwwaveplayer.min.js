!function(e,t,a,r){"use strict";var i=vwwvplVars.options,o={action:"parse_shortcode",state:["vwwaveplayer-edit"],initialize:function(){var e=this;r.ajax({url:vwwvplVars.wvpl_ajax_url.replace("%%endpoint%%",this.action),type:"post",dataType:"json",data:{nonce:vwwvplVars.nonce,post_ID:a.view.settings.post.id,type:this.shortcode.tag,shortcode:this.shortcode.string()},success:t=>{e.render(t.data)},error:t=>{e.url?(e.ignore=!0,e.removeMarkers()):e.setError(t.message||t.statusText,"admin-media")}}),this.getEditors(function(t){t.on("wpview-selected",function(){e.pausePlayers()})})},pausePlayers:function(){this.getNodes(function(e,t,a){var i=r("iframe.wpview-sandbox",a).get(0);let o=document;i&&(o=i.contentDocument||i.contentWindow.document);const l=r(o).find(".vwwaveplayer");i&&_.each(l,function(e){try{r(e).vwwaveplayer("pause")}catch(e){}})})},edit:function(e,t){var r,i=wp.shortcode.next("vwwaveplayer",e),o=this.type;if(this.pausePlayers&&this.pausePlayers(),i=i.shortcode,_.isUndefined(i.attrs.named.ids))if(_.isUndefined(i.attrs.named.url)){if(_.isUndefined(i.attrs.named.music_genre))return}else{var l=new a.model.Selection({});l.vwwaveplayer=new Backbone.Model(i.attrs.named),(r=a({frame:"post",title:a.view.l10n.editWaveplayerFromURLTitle,state:"vwwaveplayer-addFromUrl",editing:!0,selection:l}).open()).state("vwwaveplayer-addFromUrl").props.set("url",i.attrs.named.url)}else r=a.vwwaveplayer.edit(e);_.each(this.state,function(e){r.state(e).on("update",function(e){t(a.vwwaveplayer.shortcode(e).string(),"vwwaveplayer"===o)})}),r.on("close",function(){r.detach()}),r.open()}};t.register("vwwaveplayer",o);var l={action:"parse_single_shortcode",state:["audio-details"],initialize:function(){var e=this;this.url&&(this.loader=!1,this.shortcode=a.embed.shortcode({url:this.text})),r.ajax({url:vwwvplVars.wvpl_ajax_url.replace("%%endpoint%%",this.action),type:"post",dataType:"json",data:{nonce:vwwvplVars.nonce,post_ID:a.view.settings.post.id,type:this.shortcode.tag,shortcode:this.shortcode.string()},success:t=>{e.render(t.data)},error:t=>{e.url?(e.ignore=!0,e.removeMarkers()):e.setError(t.message||t.statusText,"admin-media")}}),this.getEditors(function(t){t.on("wpview-selected",function(){e.pausePlayers()})})},edit:function(e,t){var r=this.type,i=a[r].edit(e);this.pausePlayers&&this.pausePlayers(),_.each(this.state,function(e){i.state(e).on("update",function(e){t(a[r].shortcode(e).string(),"audio"===r)})}),i.on("close",function(){i.detach()}),i.open()},pausePlayers:function(){this.getNodes(function(e,t,a){var i=r("iframe.wpview-sandbox",a).get(0);i&&(i=i.contentWindow)&&i.mejs&&_.each(i.mejs.players,function(e){try{e.pause()}catch(e){}})})}};i.audio_override&&(t.unregister("audio"),t.register("audio",l)),a.view.Settings.Waveplayer=a.view.Settings.extend({className:"vwwaveplayer-settings",template:wp.template("vwwaveplayer-settings")}),a.vwwaveplayer=new a.collection({tag:"vwwaveplayer",editTitle:a.view.l10n.editWaveplayerTitle,defaults:{id:a.view.settings.post.id,url:"",catergories:"",wave_color:i.wave_color,wave_color_2:i.wave_color_2,progress_color:i.progress_color,progress_color_2:i.progress_color_2,cursor_color:i.cursor_color,cursor_color_2:i.cursor_color_2,cursor_width:i.cursor_width,hover_opacity:i.hover_opacity,gap_width:i.gap_width,wave_mode:i.wave_mode,wave_compression:i.wave_compression,wave_asymmetry:i.wave_asymmetry,size:i.size,style:i.style,info:i.info,shape:i.shape,autoplay:i.autoplay,repeat_all:i.repeat_all,shuffle:i.shuffle}}),a.controller.WavePlayerUrl=a.controller.State.extend({defaults:{id:"waveplayerUrl",title:a.view.l10n.insertFromUrlTitle,content:"waveplayerUrl",menu:"default",toolbar:"main-embed",SettingsView:a.view.Settings.Waveplayer,priority:120,type:"link",url:"",metadata:{}},initialize:function(e){this.metadata=e.metadata,this.props=new Backbone.Model(this.metadata||{url:""}),this.on("content:render:waveplayerUrl",this.renderSettings,this)},renderSettings:function(e){var t=this.get("library"),a=this.get("collectionType"),r=(this.get("dragInfoText"),this.get("SettingsView")),i={};t&&e&&(t[a]=t[a]||new Backbone.Model,i[a]=new r({controller:this,model:t[a],priority:40}),e.sidebar.set(i))}}),a.view.WavePlayerUrl=a.View.extend({className:"media-vwwaveplayer-url",initialize:function(){this.url=new a.view.EmbedUrl({tagName:"label",className:"vwwaveplayer-url",controller:this.controller,model:this.model.props}).render(),this.views.set([this.url])}});var s=a.view.MediaFrame.Post;a.view.MediaFrame.Post=s.extend({initialize:function(){var e=this.options;s.prototype.initialize.apply(this,arguments),this.options.lastNonUrlMode="browse",this.on("close",this.fixMode,this),this.states.add([new a.controller.Library({id:"vwwaveplayer",title:a.view.l10n.createWaveplayerTitle,priority:60,toolbar:"main-vwwaveplayer",filterable:"uploaded",multiple:"add",editable:!1,library:a.query(_.defaults({type:"audio"},e.library))}),new a.controller.CollectionEdit({type:"audio",collectionType:"vwwaveplayer",title:a.view.l10n.editWaveplayerTitle,SettingsView:a.view.Settings.Waveplayer,library:e.selection,editing:e.editing,menu:"vwwaveplayer",dragInfoText:a.view.l10n.waveplayerDragInfo,dragInfo:!1}),new a.controller.CollectionAdd({type:"audio",collectionType:"vwwaveplayer",title:a.view.l10n.addToWaveplayerTitle}),new a.controller.WavePlayerUrl({id:"vwwaveplayer-addFromUrl",collectionType:"vwwaveplayer",title:a.view.l10n.createWaveplayerFromURLTitle,metadata:this.options.metadata,toolbar:"vwwaveplayer-addFromUrl",menu:"waveplayerUrl",content:"waveplayerUrl",SettingsView:a.view.Settings.Waveplayer,library:e.selection,editing:e.editing,url:e.url})])},bindHandlers:function(){var e;s.prototype.bindHandlers.apply(this,arguments),this.on("menu:create:vwwaveplayer",this.createMenu,this),this.on("menu:create:waveplayerUrl",this.createMenu,this),this.on("toolbar:create:main-vwwaveplayer",this.createToolbar,this),this.on("content:activate:waveplayerUrl",this.activateUrl,this),this.on("ready activate",this.waveplayerColorPicker,this),e={menu:{vwwaveplayer:"waveplayerMenu",waveplayerUrl:"waveplayerMenu"},router:{browse:"waveplayerRouter"},content:{waveplayerUrl:"waveplayerUrlContent"},toolbar:{"main-vwwaveplayer":"waveplayerMainToolbar","vwwaveplayer-edit":"waveplayerEditToolbar","vwwaveplayer-add":"waveplayerAddToolbar","vwwaveplayer-addFromUrl":"waveplayerAddFromUrlToolbar"}},_.each(e,function(e,t){_.each(e,function(e,a){this.on(t+":render:"+a,this[e],this)},this)},this)},waveplayerMenu:function(e){var t=this.lastState(),r=t&&t.id,i=this;e.set({cancel:{text:a.view.l10n.cancelWaveplayerTitle,priority:20,click:function(){r?i.setState(r):i.close()}},separateCancel:new a.View({className:"separator",priority:40})})},waveplayerRouter:function(e){var t=this.state(),r=this.content.mode(),i=e.get("addFromUrl");"vwwaveplayer"===t.id?i?e.show("addFromUrl"):e.set({addFromUrl:{text:a.view.l10n.addWaveplayerFromURLTitle,priority:60,click:function(){this.controller.setState("vwwaveplayer-addFromUrl")}}}):(e.hide("addFromUrl"),"addFromUrl"==r&&this.content.mode(this.options.lastNonUrlMode))},activateUrl:function(){var e=this.state(),t=e.get("library"),a=e.get("collectionType"),r=e.get("SettingsView"),i={};i[a]=new r({controller:this,model:t[a],priority:40}),this.content.get("waveplayerUrl").sidebar.set(i)},waveplayerUrlContent:function(){var e=new a.view.WavePlayerUrl({controller:this,model:this.state()}).render();this.content.set(e),a.isTouchDevice||e.url.focus();var t=this.state(),r=t.get("library"),i=t.get("collectionType"),o=t.get("SettingsView"),l=e.sidebar=new a.view.Sidebar({controller:this}),s={};e.views.add(l),r[i]=r[i]||new Backbone.Model,s[i]=new o({controller:this,model:r[i],priority:40}),e.sidebar.set(s)},waveplayerMainToolbar:function(e){var t=this;this.selectionStatusToolbar(e),e.set("vwwaveplayer",{style:"primary",text:a.view.l10n.createNewWaveplayer,priority:100,requires:{selection:!0},click:function(){var e=t.state().get("selection"),r=t.state("vwwaveplayer-edit"),i=e.where({type:"audio"});r.set("library",new a.model.Selection(i,{props:e.props.toJSON(),multiple:!0})),this.controller.setState("vwwaveplayer-edit"),this.controller.modal.focusManager.focus()}})},waveplayerEditToolbar:function(){var e=this.state().get("editing");this.toolbar.set(new a.view.Toolbar({controller:this,items:{insert:{style:"primary",text:e?a.view.l10n.updateWaveplayer:a.view.l10n.insertWaveplayer,priority:80,requires:{library:!0},click:function(){var t=this.controller,r=t.state();t.close(),e?r.trigger("update",r.get("library")):a.editor.insert(a.vwwaveplayer.shortcode(r.get("library")).string()),t.setState(t.options.state),t.reset()}}}}))},waveplayerAddToolbar:function(){this.toolbar.set(new a.view.Toolbar({controller:this,items:{insert:{style:"primary",text:a.view.l10n.addToWaveplayer,priority:80,requires:{selection:!0},click:function(){var e=this.controller,t=e.state();e.state("vwwaveplayer-edit").get("library").add(t.get("selection").models),t.trigger("reset"),e.setState("vwwaveplayer-edit")}}}}))},waveplayerAddFromUrlToolbar:function(){var e=this.state().get("editing");this.toolbar.set(new a.view.Toolbar({controller:this,items:{insert:{style:"primary",text:e?a.view.l10n.updateWaveplayer:a.view.l10n.insertWaveplayer,priority:80,click:function(){var t=this.controller,r=t.state(),i=r.get("library");t.close();var o=new wp.shortcode({tag:"vwwaveplayer",type:"single",attrs:_.extend(r.props.attributes,_.omit(i.vwwaveplayer.attributes,"url"))});e?r.trigger("update",o.string()):a.editor.insert(o.string()),t.setState(t.options.state),t.reset()}}}}))},waveplayerColorPicker:function(){r(".vwwaveplayer-color-picker").length&&r(".vwwaveplayer-color-picker").wpColorPicker({change:function(e,t){r(e.target).attr("value",t.color.toString()).change()}})}})}(window,window.wp.mce.views,window.wp.media,window.jQuery);