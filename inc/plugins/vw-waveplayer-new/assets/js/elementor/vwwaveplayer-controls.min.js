"use strict";class ColorPicker extends elementorModules.Module{constructor(...e){super(...e),this.createPicker()}getDefaultSettings(){return{picker:{theme:"monolith",position:"bottom-middle",components:{opacity:!0,hue:!0,interaction:{input:!0,hex:!0,rgba:!0,hsla:!0}}},classes:{active:"elementor-active",pickerHeader:"elementor-color-picker__header",pickerToolsContainer:"e-color-picker__tools",pickerTool:"e-control-tool",clearButton:"e-color-picker__clear",plusIcon:"eicon-plus"}}}createPicker(){const e=this.getSettings("picker");e.default=e.default||null,this.picker=new Pickr(e),this.picker.setColor(e.default||"#020101"),this.color=this.processColor(),this.picker.on("change",(()=>this.onPickerChange())).on("clear",(()=>this.onPickerClear())).on("show",(()=>this.onPickerShow())).on("hide",(()=>this.onPickerHide())),this.$pickerAppContainer=jQuery(this.picker.getRoot().app),this.createPickerHeader()}addTipsyToClearButton(){this.$clearButton.tipsy({title:()=>"Clear",gravity:()=>"s"})}processColor(){const e=this.picker.getColor();let t;return t=1===e.a?e.toHEXA():e.toRGBA(),t.toString()}getColor(){return this.color}createPickerHeader(){const{classes:e}=this.getSettings(),t=jQuery("<div>",{class:e.pickerHeader}).text("Color Picker"),o=jQuery("<div>",{class:e.pickerToolsContainer}),i=this.getSettings("addButton");this.$pickerToolsContainer=o,i&&this.createAddButton(),this.createClearButton(),o.append(this.$clearButton,this.$addButton),t.append(o),this.$pickerAppContainer.prepend(t)}createAddButton(){const{classes:e}=this.getSettings();this.$addButton=jQuery("<button>",{class:e.pickerTool}).html(jQuery("<i>",{class:e.plusIcon})),this.$addButton.on("click",(()=>this.onAddButtonClick())),this.$addButton.tipsy({title:()=>"Create New Global Color",gravity:()=>"s"})}createClearButton(){const{classes:e}=this.getSettings();this.$clearButton=jQuery("<div>",{class:e.clearButton+" "+e.pickerTool}).html('<i class="eicon-undo"></i>'),this.$clearButton.on("click",(()=>this.picker._clearColor())),this.addTipsyToClearButton()}destroy(){this.picker.destroyAndRemove()}fixTipsyForFF(e){e.data("tipsy").hide()}introductionViewed(){return ColorPicker.droppingIntroductionViewed||elementor.config.user.introduction.colorPickerDropping}toggleClearButtonState(e){this.$clearButton.toggleClass("e-control-tool-disabled",!e)}onPickerChange(){this.picker.applyColor();const e=this.processColor();if(e===this.color)return;this.color=e;const t=this.getSettings("onChange");t&&t()}onPickerClear(){this.color="";const e=this.getSettings("onClear");e&&e()}onPickerShow(){const{result:e}=this.picker.getRoot().interaction,t=this.getSettings("onPickerShow");t&&t(),setTimeout((()=>{e.select()}),100)}onPickerHide(){const e=this.getSettings("onPickerHide");e&&e()}onAddButtonClick(){this.picker.hide();const e=this.getSettings("onAddButtonClick");e&&e(),this.fixTipsyForFF(this.$addButton)}}elementor.addControlView("ColorTuplet",elementor.modules.controls.BaseMultiple.extend({ui:function(){var e=elementor.modules.controls.BaseMultiple.prototype.ui.apply(this,arguments);return e.colorPickerPlaceholder=".elementor-color-picker-placeholder",e},initColors:function(){var e=this;this.colorPicker1=new ColorPicker({picker:{el:this.ui.colorPickerPlaceholder[0],default:this.getControlValue(this.model.get("name"))},onChange:function(){e.setValue(e.model.attributes.name,e.colorPicker1.getColor())},onClear:function(){e.setValue(e.model.attributes.name,"")}}),this.colorPicker2=new ColorPicker({picker:{el:this.ui.colorPickerPlaceholder[1],default:this.getControlValue(this.model.get("name")+"_2")},onChange:function(){e.setValue(`${e.model.attributes.name}_2`,e.colorPicker2.getColor())},onClear:function(){e.setValue(`${e.model.attributes.name}_2`,"")}})},onReady:function(){this.initColors()},onBeforeDestroy:function(){this.colorPicker1.destroy(),this.colorPicker2.destroy()}})),elementor.addControlView("Playlist",elementor.modules.controls.BaseData.extend({ui:function(){var e=elementor.modules.controls.BaseData.prototype.ui.apply(this,arguments);return e.addTracks=".elementor-control-playlist-add",e.clearPlaylist=".elementor-control-playlist-clear",e.playlistThumbnails=".elementor-control-playlist-thumbnails",e.status=".elementor-control-playlist-status-title",e},events:function(){return _.extend(elementor.modules.controls.BaseData.prototype.events.apply(this,arguments),{"click @ui.addTracks":"onAddTracksClick","click @ui.clearPlaylist":"onClearPlaylistClick","click @ui.playlistThumbnails":"onPlaylistThumbnailsClick"})},onReady:function(){this.initRemoveDialog()},applySavedValue:function(){var e=this.getControlValue(),t=e.length,o=!!t;if(this.$el.toggleClass("elementor-playlist-has-tracks",o).toggleClass("elementor-playlist-empty",!o),this.ui.status.text(elementor.translate(o?"playlist_tracks_selected":"playlist_no_tracks_selected",[t])),this.ui.playlistThumbnails.empty(),o){var i=wp.media.query({orderby:"post__in",order:"ASC",type:"audio",perPage:-1,post__in:_.pluck(e,"id")});i.more().done((()=>{this.buildThumbnails(i)}))}},buildThumbnails:function(e){var t=this.ui.playlistThumbnails;this.getControlValue().forEach((function(o){var i=jQuery("<div>",{class:"elementor-control-playlist-thumbnail"});const r=Object.values(e.models).find((e=>e.id===o.id));r&&r.attributes&&r.attributes.thumb&&i.css("background-image","url("+r.attributes.thumb.src+")"),t.append(i)}))},hasTracks:function(){return!!this.getControlValue().length},openFrame:function(e){this.initFrame(e),this.frame.open()},initFrame:function(e){var t={frame:"post",multiple:!0,state:{create:"playlist",add:"playlist-library",edit:"playlist-edit"}[e],button:{text:elementor.translate("insert_tracks")}};this.hasTracks()&&(t.selection=this.fetchSelection()),this.frame=wp.media(t),this.frame.on({update:this.select,"menu:render:default":this.menuRender,"content:render:browse":this.playlistSettings},this)},menuRender:function(e){e.unset("insert"),e.unset("featured-image")},playlistSettings:function(e){e.sidebar.on("ready",(function(){e.sidebar.unset("playlist")}))},fetchSelection:function(){var e=wp.media.query({orderby:"post__in",order:"ASC",type:"audio",perPage:-1,post__in:_.pluck(this.getControlValue(),"id")});return new wp.media.model.Selection(e.models,{props:e.props.toJSON(),multiple:!0})},select:function(e){var t=[];e.each((function(e){t.push({id:e.get("id"),url:e.get("url")})})),this.setValue(t),this.applySavedValue()},onBeforeDestroy:function(){this.frame&&this.frame.off(),this.$el.remove()},resetPlaylist:function(){this.setValue([]),this.applySavedValue()},initRemoveDialog:function(){var e;this.getRemoveDialog=function(){return e||(e=elementorCommon.dialogsManager.createWidget("confirm",{message:elementor.translate("dialog_confirm_playlist_delete"),headerMessage:elementor.translate("delete_playlist"),strings:{confirm:elementor.translate("delete"),cancel:elementor.translate("cancel")},defaultOption:"confirm",onConfirm:this.resetPlaylist.bind(this)})),e}},onAddTracksClick:function(){this.openFrame(this.hasTracks()?"add":"create")},onClearPlaylistClick:function(){this.getRemoveDialog().show()},onPlaylistThumbnailsClick:function(){this.openFrame("edit")}}));